language: java
dist: trusty
addons:
  sonarcloud:
    organization: "pow25-github" # the key of the org you chose at step #3
#    token:
#      secure: sZbJ89c08BsRWUydTYQaEq+rH9ngLfiuMHQ0U4/zbgnyeyS6JnXOcDjL1072pHtZlpFlM/atVAdt4A0WQZ923WseEPPj2oC47dTm/stAcVEpQ4YvmIrlSxxKWQ+MLB734P9n4sZ54YULN1wfvJYUg0NFdWAsLikU+uf2kgGQr+dTXJpxHK1rugxh87FTZhsfxE3adHa+04cR42kDj3AR1zXwKONoSC3SExYrPNj6KpfpAKZbnc6qII6naUIuqxTbYH7r+gvfyqbhvru5Cg0LlxUINyu/eMc4Je9xlyNrEwylPH06kIi2GpMpf9NFAvphRn1aNGKxjxWqKMkbP0Sho8zHGuP1JVzHhWnSlVFf6yknJ/i9pZ4B9AapHADvE6DYQwUewIk+VWUuC3hXCihjy6leyA6CeZ7h4mSYjdW8nqZzkMKhCgX5Ue1zFcd9Xii0DYwsjOzJhuOo5DDPjL4a/G1dUWDTr4SiZm9OIyFgou8c6TfDWNwHl/5jU19vpdVlYwrnpLRrs0Cb0jUy+1AxGjrZ37URJslOO+IaTYzH5cpAwKL5geTVaCXYxGZ1+YAOk83GPUCeDsd2j4tw0/p3rabtGj4ikAAgcIF9YGQ5/adIttwUOctkei8zU/jN76PvnbcqXLmNqtx1b8VIApiaZVhUZ9vPfelCscDHpfaEsSY=

script:
  # other script steps might be done before running the actual analysis
  #- sonar-scanner
  #- mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar
  - mvn clean install sonar:sonar test surefire-report:report
  - ls -a 
  - find /home/travis -name "*.html"
  - ls -a /home/travis/build/pow25/vergilplus/target/sonar/
  - ls -a /home/travis/build/pow25/vergilplus/target/sonar/ucfg/java
  - ls -a /home/travis/build/pow25/vergilplus/target/sonar/ucfg2/java
  
services:
  - mysql
before_install:
  - mysql -u root --password="" -e "CREATE DATABASE vergilplus;"
  - mysql -e "CREATE USER 'dbuser'@'localhsot' IDENTIFIED BY 'dbuser';"
  - mysql -e "GRANT ALL PRIVILEGES ON vergilplus.* TO 'dbuser'@'localhost' IDENTIFIED BY 'dbuser';"
  - mysql -e "USE vergilplus;SOURCE ./data/vergilplus.sql;"
  - chmod +x push.sh
after_success:
  - ./push.sh

# before_deploy:
#   # Set up git user name and tag this commit
#   - git config --local user.name "pow25"
#   - git config --local user.email "zhangchi8518@gmial.com"
#   - git tag "$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)"
# deploy:
#   provider: releases
#   api_key: $GITHUB
#   file: 
#     - "./target/surefire-reports/com.vplus.maven.vplus.AppTest.txt"
#     - "./target/surefire-reports/TEST-com.vplus.maven.vplus.AppTest.xml"
#   skip_cleanup: true
